"use strict";function AngularFire(t,e,r,n){this._q=t,this._parse=e,this._timeout=r,this._initial=!0,this._remoteValue=!1,this._fRef="string"==typeof n?new Firebase(n):n}angular.module("firebase",[]).value("Firebase",Firebase),angular.module("firebase").factory("angularFire",["$q","$parse","$timeout",function(t,e,r){return function(n,i,a){var o=new AngularFire(t,e,r,n);return o.associate(i,a)}}]),AngularFire.prototype={associate:function(t,e){var r=this,n=this._q.defer(),i=n.promise;return this._fRef.on("value",function(i){var a=i.val(),o=JSON.parse(angular.toJson(r._parse(e)(t)));if(r._initial){r._initial=!1;var u=!1,c=Object.prototype.toString;if(a&&c.call(o)==c.call(a))if("[object Array]"==c.call(o))u=o.concat(a);else if("[object Object]"==c.call(localval)){u=o;for(var s in a)u[s]=a[s]}if(null===a&&(u=o),u)return r._fRef.ref().set(u),void 0}var l=!1;n&&(l=n,n=!1),r._timeout(function(){r._resolve(t,e,l,a)})}),i},disassociate:function(){var t=this;t._unregister&&t._unregister(),this._fRef.off("value")},_resolve:function(t,e,r,n){var i=this;if(null===n){var a=t[e];if("object"==typeof a){var o=Object.prototype.toString;n=o.call(a)==o.call([])?[]:{}}}this._remoteValue=angular.copy(n),this._parse(e).assign(t,angular.copy(n)),r&&(r.resolve(function(){i.disassociate()}),this._watch(t,e))},_watch:function(t,e){var r=this;r._unregister=t.$watch(e,function(){if(!r._initial){var n=JSON.parse(angular.toJson(r._parse(e)(t)));angular.equals(n,r._remoteValue)||r._fRef.ref().set(n)}},!0),t.$on("$destroy",function(){r.disassociate()})},_log:function(t){console&&console.log&&console.log(t)}},angular.module("firebase").factory("angularFireCollection",["$timeout",function(t){return function(e,r){function n(t,e){this.$ref=t.ref(),this.$id=t.name(),this.$index=e,angular.extend(this,{$priority:t.getPriority()},t.val())}function i(t){return t?h[t]+1:0}function a(t,e){h[e.$id]=t,g.splice(t,0,e)}function o(t){var e=h[t];g.splice(e,1),h[t]=void 0}function u(t,e){g[t]=e}function c(t,e,r){g.splice(t,1),g.splice(e,0,r),s(t,e)}function s(t,e){var r=g.length;e=e||r,e>r&&(e=r);for(var n=t;e>n;n++){var i=g[n];i.$index=h[i.$id]=n}}var l,f=[function(t){return null==t.$priority?0:angular.isNumber(t.$priority)?1:angular.isString(t.$priority)?2:void 0},function(t){return t.$priority?t.$priority:1/0},function(t){return t.$id}],h={},g=[];return l="string"==typeof e?new Firebase(e):e,r&&"function"==typeof r&&l.once("value",r),l.on("child_added",function(e,r){t(function(){var t=i(r);a(t,new n(e,t)),s(t)})}),l.on("child_removed",function(e){t(function(){var t=e.name(),r=h[t];o(t),s(r)})}),l.on("child_changed",function(e,r){t(function(){var t=h[e.name()],a=i(r),o=new n(e,t);u(t,o),a!==t&&c(t,a,o)})}),l.on("child_moved",function(e,r){t(function(){var t=h[e.name()],n=i(r),a=g[t];c(t,n,a)})}),g.getByName=function(t){return g[h[t]]},g.add=function(t,e){var r;return r=e?l.ref().push(t,e):l.ref().push(t)},g.remove=function(t,e){var r=angular.isString(t)?g[h[t]]:t;e?r.$ref.remove(e):r.$ref.remove()},g.update=function(t,e){var r=angular.isString(t)?g[h[t]]:t,n={};angular.forEach(r,function(t,e){0!==e.indexOf("$")&&(n[e]=t)}),e?r.$ref.set(n,e):r.$ref.set(n)},g.order=f,g}}]),angular.module("firebase").factory("angularFireAuth",["$rootScope","$parse","$timeout","$location","$route","$q",function(t,e,r,n,i,a){function o(t){var e=t.split(".");if(!e instanceof Array||3!==e.length)throw new Error("Invalid JWT");var r=e[1];return JSON.parse(decodeURIComponent(escape(window.atob(r))))}function u(t,n,i,a){n&&r(function(){e(n).assign(t,i),a()})}function c(t,e,r){t.authRequired&&!r._authenticated&&(r._redirectTo=void 0===t.pathTo?n.path():t.pathTo===e?"/":t.pathTo,n.replace(),n.path(e))}return{initialize:function(e,r){var n=this;if(r=r||{},this._scope=t,!r.scope)throw new Exception("Scope not provided to angularFireAuth!");if(this._scope=r.scope,!r.name)throw new Exception("Model name not provided to angularFireAuth!");if(this._name=r.name,this._cb=function(){},r.callback&&"function"==typeof r.callback&&(this._cb=r.callback),this._redirectTo=null,this._authenticated=!1,r.path&&(i.current&&c(i.current,r.path,n),t.$on("$routeChangeStart",function(t,e){c(e,r.path,n)})),this._ref=new Firebase(e),r.simple===!1)return u(this._scope,this._name,null),void 0;if(!window.FirebaseSimpleLogin){var a=new Error("FirebaseSimpleLogin undefined, did you include firebase-simple-login.js?");return t.$broadcast("angularFireAuth:error",a),void 0}var o=new FirebaseSimpleLogin(this._ref,function(e,r){n._cb(e,r),e?t.$broadcast("angularFireAuth:error",e):r?n._loggedIn(r):n._loggedOut()});this._authClient=o},login:function(e,r){var n=this._watchForLogin();switch(e){case"github":case"persona":case"twitter":case"facebook":case"password":if(this._authClient)this._authClient.login(e,r);else{var i=new Error("Simple Login not initialized");t.$broadcast("angularFireAuth:error",i)}break;default:var a,u=this;try{a=o(e),this._ref.auth(e,function(e){e?t.$broadcast("angularFireAuth:error",e):u._loggedIn(a)})}catch(c){t.$broadcast("angularFireAuth:error",c)}}return n},createUser:function(e,n,i,a){var o=this;this._authClient.createUser(e,n,function(u,c){try{u?t.$broadcast("angularFireAuth:error",u):a||o.login("password",{email:e,password:n})}catch(s){t.$broadcast("angularFireAuth:error",s)}i&&r(function(){i(u,c)})})},logout:function(){this._authClient?this._authClient.logout():(this._ref.unauth(),this._loggedOut())},_loggedIn:function(e){var r=this;this._authenticated=!0,u(this._scope,this._name,e,function(){t.$broadcast("angularFireAuth:login",e),r._redirectTo&&(n.replace(),n.path(r._redirectTo),r._redirectTo=null)})},_loggedOut:function(){this._authenticated=!1,u(this._scope,this._name,null,function(){t.$broadcast("angularFireAuth:logout")})},_watchForLogin:function(){function e(t,e){r(function(){t?i.reject(t):i.resolve(e)});for(var a=0;a<n.length;a++)n[a]()}var n=[],i=a.defer();return n.push(t.$on("angularFireAuth:login",function(t,r){e(null,r)})),n.push(t.$on("angularFireAuth:error",function(t,r){e(r,null)})),i.promise}}}]);