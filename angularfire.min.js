"use strict";!function(){var a,b;angular.module("firebase",[]).value("Firebase",Firebase),angular.module("firebase").factory("$firebase",["$q","$parse","$timeout",function(b,c,d){return function(e){var f=new a(b,c,d,e);return f.construct()}}]),angular.module("firebase").filter("orderByPriority",function(){return function(a){if(!a)return[];if(!a.$getIndex||"function"!=typeof a.$getIndex){var b=Object.prototype.toString.call(a);if("object"==typeof a&&"[object Object]"==b){var c=[];for(var d in a)a.hasOwnProperty(d)&&c.push(a[d]);return c}return a}var e=[],f=a.$getIndex();if(f.length<=0)return a;for(var g=0;g<f.length;g++){var h=a[f[g]];h&&(h.$id=f[g],e.push(h))}return e}}),Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){if(void 0===this||null===this)throw new TypeError("'this' is null or not defined");var c=this.length>>>0;for(b=+b||0,1/0===Math.abs(b)&&(b=0),0>b&&(b+=c,0>b&&(b=0));c>b;b++)if(this[b]===a)return b;return-1}),a=function(a,b,c,d){if(this._q=a,this._bound=!1,this._loaded=!1,this._parse=b,this._timeout=c,this._index=[],this._onChange=[],this._onLoaded=[],"string"==typeof d)throw new Error("Please provide a Firebase reference instead of a URL, eg: new Firebase(url)");this._fRef=d},a.prototype={construct:function(){var b=this,c={};return c.$bind=function(a,c){return b._bind(a,c)},c.$add=function(a){function c(a){a?e.reject(a):e.resolve()}var d,e=b._q.defer();return d="object"==typeof a?b._fRef.ref().push(b._parseObject(a),c):b._fRef.ref().push(a,c),e.promise},c.$save=function(a){function c(a){a?d.reject(a):d.resolve()}var d=b._q.defer();if(a){var e=b._parseObject(b._object[a]);b._fRef.ref().child(a).set(e,c)}else b._fRef.ref().set(b._parseObject(b._object),c);return d.promise},c.$set=function(a){var c=b._q.defer();return b._fRef.ref().set(a,function(a){a?c.reject(a):c.resolve()}),c.promise},c.$remove=function(a){function c(a){a?d.reject(a):d.resolve()}var d=b._q.defer();return a?b._fRef.ref().child(a).remove(c):b._fRef.ref().remove(c),d.promise},c.$child=function(c){var d=new a(b._q,b._parse,b._timeout,b._fRef.ref().child(c));return d.construct()},c.$on=function(a,c){switch(a){case"change":b._onChange.push(c);break;case"loaded":b._onLoaded.push(c);break;default:throw new Error("Invalid event type "+a+" specified")}},c.$auth=function(a){var c=b._q.defer();return b._fRef.auth(a,function(a,b){null!==a?c.reject(a):c.resolve(b)},function(a){c.reject(a)}),c.promise},c.$getIndex=function(){return angular.copy(b._index)},b._object=c,b._getInitialValue(),b._object},_getInitialValue:function(){var a=this,b=function(c){var d=c.val();if(null===d&&a._bound){var e=a._parseObject(a._parse(a._name)(a._scope));switch(typeof e){case"string":case"undefined":d="";break;case"number":d=0;break;case"boolean":d=!1}}switch(typeof d){case"string":case"number":case"boolean":a._updatePrimitive(d);break;case"object":a._getChildValues(),a._fRef.off("value",b);break;default:throw new Error("Unexpected type from remote data "+typeof d)}a._loaded=!0,a._broadcastEvent("loaded",d)};a._fRef.on("value",b)},_getChildValues:function(){function a(a,c){var d=a.name(),e=a.val(),f=b._index.indexOf(d);if(-1!==f&&b._index.splice(f,1),c){var g=b._index.indexOf(c);b._index.splice(g+1,0,d)}else b._index.unshift(d);null!==a.getPriority()&&(e.$priority=a.getPriority()),b._updateModel(d,e)}var b=this;b._fRef.on("child_added",a),b._fRef.on("child_moved",a),b._fRef.on("child_changed",a),b._fRef.on("child_removed",function(a){var c=a.name(),d=b._index.indexOf(c);b._index.splice(d,1),b._updateModel(c,null)})},_updateModel:function(a,b){var c=this;c._timeout(function(){if(null==b?delete c._object[a]:c._object[a]=b,c._broadcastEvent("change"),c._bound){var d=c._object,e=c._parse(c._name)(c._scope);angular.equals(d,e)||c._parse(c._name).assign(c._scope,angular.copy(d))}})},_updatePrimitive:function(a){var b=this;b._timeout(function(){if(b._object.$value&&angular.equals(b._object.$value,a)||(b._object.$value=a),b._broadcastEvent("change"),b._bound){var c=b._parseObject(b._parse(b._name)(b._scope));angular.equals(c,a)||b._parse(b._name).assign(b._scope,a)}})},_broadcastEvent:function(a,b){function c(a,b){e._timeout(function(){a(b)})}var d,e=this;switch(a){case"change":d=this._onChange;break;case"loaded":d=this._onLoaded;break;default:d=[]}if(d.length>0)for(var f=0;f<d.length;f++)"function"==typeof d[f]&&c(d[f],b)},_bind:function(a,b){var c=this,d=c._q.defer();c._name=b,c._bound=!0,c._scope=a;var e=c._parse(b)(a);void 0!==e&&"object"==typeof e&&c._fRef.update(c._parseObject(e));var f=a.$watch(b,function(){var d=c._parseObject(c._parse(b)(a));c._object.$value&&angular.equals(d,c._object.$value)||angular.equals(d,c._object)||void 0!==d&&c._loaded&&(c._fRef.set?c._fRef.set(d):c._fRef.ref().update(d))},!0);return a.$on("$destroy",function(){f()}),c._fRef.once("value",function(){d.resolve(f)}),d.promise},_parseObject:function(a){function b(a){for(var c in a)a.hasOwnProperty(c)&&("$priority"==c?(a[".priority"]=a.$priority,delete a.$priority):"object"==typeof a[c]&&b(a[c]));return a}var c=b(angular.copy(a));return angular.fromJson(angular.toJson(c))}},angular.module("firebase").factory("$firebaseSimpleLogin",["$q","$timeout","$rootScope",function(a,c,d){return function(e){var f=new b(a,c,d,e);return f.construct()}}]),b=function(a,b,c,d){if(this._q=a,this._timeout=b,this._rootScope=c,this._deferred=null,this._authenticated=!1,"string"==typeof d)throw new Error("Please provide a Firebase reference instead of a URL, eg: new Firebase(url)");this._fRef=d},b.prototype={construct:function(){var a={user:null,$login:this.login.bind(this),$logout:this.logout.bind(this),$createUser:this.createUser.bind(this),$changePassword:this.changePassword.bind(this)};if(this._object=a,!window.FirebaseSimpleLogin){var b=new Error("FirebaseSimpleLogin is undefined. Did you forget to include firebase-simple-login.js?");throw this._rootScope.$broadcast("$firebaseSimpleLogin:error",b),b}var c=new FirebaseSimpleLogin(this._fRef,this._onLoginEvent.bind(this));return this._authClient=c,this._object},login:function(a,b){return this._deferred=this._q.defer(),this._authClient.login(a,b),this._deferred.promise},logout:function(){this._authClient.logout()},createUser:function(a,b,c,d){var e=this;e._authClient.createUser(a,b,function(f,g){try{f?e._rootScope.$broadcast("$firebaseSimpleLogin:error",f):d||e.login("password",{email:a,password:b})}catch(h){e._rootScope.$broadcast("$firebaseSimpleLogin:error",h)}c&&e._timeout(function(){c(f,g)})})},changePassword:function(a,b,c,d){var e=this;e._authClient.changePassword(a,b,c,function(a,b){a&&e._rootScope.$broadcast("$firebaseSimpleLogin:error",a),d&&e._timeout(function(){d(a,b)})})},_onLoginEvent:function(a,b){var c=this;a?(c._deferred&&(c._deferred.reject(a),c._deferred=null),c._rootScope.$broadcast("$firebaseSimpleLogin:error",a)):b?(c._deferred&&(c._deferred.resolve(b),c._deferred=null),c._timeout(function(){c._object.user=b,c._authenticated=!0,c._rootScope.$broadcast("$firebaseSimpleLogin:login",b)})):c._timeout(function(){c._object.user=null,c._authenticated=!1,c._rootScope.$broadcast("$firebaseSimpleLogin:logout")})}}}();